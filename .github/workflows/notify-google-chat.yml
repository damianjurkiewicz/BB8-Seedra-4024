name: Notify Google Chat on Push

on:
  push:
    branches:
      - main  # lub zmieÅ„ na master/dev â€“ zaleÅ¼nie od repo

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Extract commit data
        run: |
          echo "LAST_COMMIT_MESSAGE=$(git log -1 --pretty=format:'%s')" >> $GITHUB_ENV
          echo "LAST_COMMIT_URL=$(git log -1 --pretty=format:'https://github.com/${{ github.repository }}/commit/%H')" >> $GITHUB_ENV
          echo "AUTHOR_NAME=$(git log -1 --pretty=format:'%an')" >> $GITHUB_ENV
          echo "BRANCH_NAME=${GITHUB_REF#refs/heads/}" >> $GITHUB_ENV

      - name: Send commit to Google Chat
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            -d "{
              \"text\": \"ğŸ§  *Commit pushed*\nğŸ‘¤ Author: $AUTHOR_NAME\nğŸŒ¿ Branch: $BRANCH_NAME\nğŸ“ Message: $LAST_COMMIT_MESSAGE\nğŸ”— [Zobacz commit]($LAST_COMMIT_URL)\"
            }" \
            "$GOOGLE_CHAT_WEBHOOK"
        env:
          GOOGLE_CHAT_WEBHOOK: ${{ secrets.GOOGLE_CHAT_WEBHOOK }}
